<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistics Exercise 3. Statistical tests and regression models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Exercise_3_files/libs/clipboard/clipboard.min.js"></script>
<script src="Exercise_3_files/libs/quarto-html/quarto.js"></script>
<script src="Exercise_3_files/libs/quarto-html/popper.min.js"></script>
<script src="Exercise_3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Exercise_3_files/libs/quarto-html/anchor.min.js"></script>
<link href="Exercise_3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Exercise_3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Exercise_3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Exercise_3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Exercise_3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#adding-an-add-in-in-excel" id="toc-adding-an-add-in-in-excel" class="nav-link" data-scroll-target="#adding-an-add-in-in-excel"><span class="header-section-number">2</span> Adding an add-in in Excel</a></li>
  <li><a href="#comparing-groups" id="toc-comparing-groups" class="nav-link" data-scroll-target="#comparing-groups"><span class="header-section-number">3</span> Comparing groups</a></li>
  <li><a href="#test-outcomes-through-simulations" id="toc-test-outcomes-through-simulations" class="nav-link" data-scroll-target="#test-outcomes-through-simulations"><span class="header-section-number">4</span> Test outcomes through simulations</a></li>
  <li><a href="#relations-between-numerical-variables" id="toc-relations-between-numerical-variables" class="nav-link" data-scroll-target="#relations-between-numerical-variables"><span class="header-section-number">5</span> Relations between numerical variables</a>
  <ul class="collapse">
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation"><span class="header-section-number">5.1</span> Correlation</a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="header-section-number">5.2</span> Regression</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Exercise_3.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Statistics Exercise 3. Statistical tests and regression models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this third and final exercise we look at the most common use of statistics in the sciences – the use of inference to draw statistically significant conclusions from experimental or observational data. Firstly we look at a method to test equality between two different groups (the two-sample t-test) and secondly we look at a method to test for a connection between two numerical variables (simple regression). In order to do this we will also look at an Excel add-in called <em>Analysis Toolpak</em>.</p>
<p>We will use three different datasets: a common example dataset on penguins, the teabag data used in the soil assignment, and some scientific data from a study at the Southern Swedish Forest Research Center.</p>
</section>
<section id="adding-an-add-in-in-excel" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Adding an add-in in Excel</h1>
<p>The functionality of Excel can be expanded with add-ins. Some of these come with an Excel installation but need to be activated before use. The exact way to do this may differ a bit between Excel version.</p>
<ol type="1">
<li>Open an empty Excel workbook. Go to <em>File</em> in the ribbon at the top. Go to <em>Options</em> at the bottom of the list to the left.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/301-options.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Finding options under File.</figcaption>
</figure>
</div>
<ol start="2" type="1">
<li>In the new window, find <em>Add-ins</em> in the list to the left. This will give a page showing the current active and inactive add-ins. At the bottom of that page, click <em>Go…</em>, then check the <em>Analysis ToolPak</em> and click <em>OK</em>. Go back to empty sheet and go to the <em>Data</em> ribbon. If the add-in has been successfully added there should be a button to the right of the ribbon with the name <em>Data Analysis</em>.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/302-addins.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Add add-ins by clicking the Go button at the bottom.</figcaption>
</figure>
</div>
</section>
<section id="comparing-groups" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Comparing groups</h1>
<p>One fundamental use of statistics in the science is to test hypotheses using a method called <em>null hypothesis significance testing</em>. One example of this is the two-sample t-test. Two hypotheses are set up: a null hypothesis which states that two groups are equal in population mean and an alternative hypothesis which states that they are not equal. Based on underlying statistical theory it is possible to calculate a p-value. The p-value is the probability of getting a more extreme difference between the two groups than the difference we are observing. If the data is completely in line with the null hypothesis the p-value is one and if the data is very far from the null hypothesis the p-value is near zero. A p-value below 0.05 gives that the null hypothesis is <em>rejected</em> and that there is a <em>significant</em> difference between the groups.</p>
<p>At the end of the last computer exercise we calculated diversity index for each site in the bird experiment. We saw that there was some visual difference between the treatment group and the control group. Let us now do a formal test to see if this difference is significant.</p>
<ol start="3" type="1">
<li>Download the Excel file <em>Computer-exercise-3.xlsx</em> from the Canvas page. Find the sheet <em>bird-tree-experiment</em>, which contains the indices per site. This data is in what we would call long form with each site one row.</li>
<li>For clarity, state the hypotheses in an empty area next to the data. The null hypothesis is that the two groups have the same population mean diversity, while the alternative is that there is a difference in population means.</li>
<li>The p-value of a test can be calculated in a few different way. The most straight-forward is to use the <code>T.TEST</code> function. In an empty area below the null and alternative hypothesis, write <code>T.TEST(F2:F17;F18:F33;2;2)</code>. The function has four argument:</li>
</ol>
<ul>
<li>the first argument <code>F2:F17</code> is the data for the first group,</li>
<li>the second argument <code>F18:F33</code> is the data for the second group,</li>
<li>the third argument, here a <code>2</code>, states that the test should be <em>two-tailed</em> which means that we are testing both for an increasing effect of the treatment and for a decreasing effect,</li>
<li>the fourth argument, here a <code>2</code>, sets the type of tests. Here we want a test for two-samples with an assumption of equal variances.</li>
</ul>
<ol start="6" type="1">
<li>The result of the <code>T.TEST</code> function is the p-value. Interpret the p-value. Is there a significant difference between the control and the treatment? What is the interpretation of this in terms of the actual example?</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/306-div-t-test2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Presentation of the p-value after calculating it using the <code>T.TEST</code> function.</figcaption>
</figure>
</div>
<p>A t-test can also be done using the <em>Analysis ToolPak</em>. This gives a will give some additional information as well.</p>
<ol start="7" type="1">
<li>Go to the <em>Data</em> ribbon and click the <em>Data analysis</em> button to the right.</li>
<li>Find the method called <em>t-Test: Two-Sample Assuming Equal Variances</em> and click <em>OK</em>.</li>
<li>In the dialog window select the observation from the control as the first range and those of the treatment as the second range. Set the hypothesized mean difference to zero. Let the output be in a new sheet. The output shows the mean, variance and number of observation of both variables. The pooled variance, df (for <em>degrees of freedom</em>), <em>t Stat</em> and the two <em>t Critical</em> values are measures used when calculating the test. <em>P(T&lt;=t) one-tail</em> is the one-tailed p-value (which is rarely used) and <em>P(T&lt;=t) two-tail</em> is the two-tailed p-value. The latter should be the same as that given by <code>T.TEST</code>.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/308-t-test-analysis-toolpak2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Input to the t-test function in Analysis Toolpak.</figcaption>
</figure>
</div>
<ol start="8" type="1">
<li>The sheet <em>teabags</em> contains the data from your teabag decomposition experiment. It is sorted by green/red tea. Use this data to test for a difference in decomposition between red and green tea.</li>
<li>When doing a hypothesis test we test for a difference in <em>populations</em> using the observed <em>samples</em>. What can be considered the populations in the teabag experiment?</li>
<li>Sort by group and use <code>T.TEST</code> to test a relevant hypothesis on data from your own group. Are the tests in line with your informal interpretation of the data: are there significant differences that were not expected or non-significant differences where one would expect?</li>
</ol>
<p>The hypothesis test is not perfect. It is possible to have actual population differences that are not captured by the test, as well as equal populations which by pure chance result in samples which give a significant difference. OF course, we cannot know this since we cannot observe the actual populations, but we can understand this phenomena using simulations.</p>
</section>
<section id="test-outcomes-through-simulations" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Test outcomes through simulations</h1>
<p>The sheet <em>simulation</em> contains a case where samples are generated from known populations. The samples are randomly generated by Excel. To make a new draw one can press <em>delete</em> while marking an empty cell.</p>
<p>At the top of the sheet one can set the mean and standard deviations of two normal distributions. These are the distributions from which the random samples are drawn. Below that the two distributions are illustrated as curves. Further below we see the two random samples - six from each population. Below that is the test information. We can see the p-value and a text stating the conclusion of the test as accepting or rejecting the null hypothesis. As always the null hypothesis is that the two groups have the same population mean.</p>
<ol start="11" type="1">
<li>Make sure the populations have the same mean (say 30 for both). Mark an empty cell and press delete to generate a new random sample. Note the p-value. Since we set the populations to be equal, the <em>correct</em> outcome is for the test to accept the null hypothesis. This will however not always happen. Re-do the random sample forty times and note how often the test rejects the null hypothesis.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/310-sim1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Simulation where the null hypothesis is true.</figcaption>
</figure>
</div>
<ol start="12" type="1">
<li>Next let the populations be quite difference. For example one population can have mean 40 and one population mean 30, with both standard deviations being 2. Re-do the random sample a few time and note how often the test reject.</li>
<li>Finally, set the populations to being similar but with some overlap. This could for example be means of 30 and 31 and both distributions having standard deviation of 2. This is a case where we would like the test to reject the null hypothesis since there is an actual difference between the populations. This will however not always happen. Re-do the sampling a few times. Is it common for the test to accept the null hypothesis?</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/311-sim2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Simulation where the null hypothesis is false.</figcaption>
</figure>
</div>
<p>These two possible errors are known as type I and type II, with type I being the case of rejecting a true null hypothesis (a low p-value even though the populations are the same) and type II being the case of accepting a false null hypothesis (a high p-value even though the populations are different). The hypothesis tests are constructed so that the probability of a type I error equals the significance level, so in most cases this risk is five percent.</p>
</section>
<section id="relations-between-numerical-variables" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Relations between numerical variables</h1>
<p>We often want to capture the relation between two numerical variables. It could for example be the effect of soil pH on teabag decomposition, or the relation between time and tree height. There are two fundamental methods for this. <em>Correlation</em>, which gives a measure between -1 and 1 of how strong the connection between variables is, and <em>regression</em>, which models one variable (a <em>response</em>) as a function of another (an <em>explanatory</em> variable).</p>
<section id="correlation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="correlation"><span class="header-section-number">5.1</span> Correlation</h2>
<p>The correlation between two variables can be calculated with the function <code>CORREL</code>. The input are the two ranges of cells and the output is the correlation measure. Here we calculate the correlation between flipper size and body size from a data on penguins measurement. This is an extract from the <em>Palmer penguins data</em>, a commonly used example data. See allisonhorst.github.io/palmerpenguins for additional information.</p>
<ol start="14" type="1">
<li>Go to the sheet <em>penguins</em>. It contains data on species and various size measurements for sixty penguins. Go to an empty cell beside the dataset, for example <code>L2</code>. Write the formula <code>=CORREL(E2:E61;F2:F61)</code>. The output should be the correlation between flipper length (the E column) and body mass (the F columns). Is there a positive or negative correlation? What is the interpretation of this in terms of the original variables?</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/312-correl1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Calculating the correlation with <code>CORREL</code>.</figcaption>
</figure>
</div>
<ol start="15" type="1">
<li>Use the correlation function <code>CORREL</code> to calculate the correlation flippers and body mass for each of the three species. Are these correlations larger or smaller than the overall correlation?</li>
<li>The difference between groups can be illustrated with a scatterplot with different colors for different species. This requires a that the data is given as different <em>series</em> in the graph, which can be done by separating them into different columns. An examples of this can be seen in the sheet <em>penguins-separate-series</em>. Mark the four data columns (columns B, C, D and E) and insert a scatterplot by going to the <em>Insert</em> ribbon and picking the small icon for the scatter (usually bottom middle of the icons). This should give a scatterplot where each of the groups can be seen in different colors. The range of the axes can be changed by double-clicking and axis and changing the range in the format window to the right. Given the graph, are the calculated correlations reasonable?</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/314-correl-scatter.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Scatterplot with colors by group.</figcaption>
</figure>
</div>
</section>
<section id="regression" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="regression"><span class="header-section-number">5.2</span> Regression</h2>
<p>In <em>regression</em> a response variable (<em>y</em>) is seen as a function of another function (<em>x</em>). We can illustrate (and get the estimates) of this model using the scatterplot.</p>
<ol start="17" type="1">
<li>Go to the <em>penguins</em> sheet and produce a scatterplot of flipper and body mass. (By marking the data for those two columns and inserting a scatterplot). Next click the green plus next to the graph and select <em>Trendline</em>. You will see a dotted line in the graph. Double-click to reach the format window to the right. Find the section with <em>Trendline options</em> and check <em>Display Equation on chart</em>. This should give an equation in the graph. Try to interpret this model equation. What is the value of y when the x-variable is zero? How much does y increase when x increases by one unit?</li>
<li>We can get some additional information using the <em>Analysis ToolPak</em>. Go to the <em>Data</em> ribbon and click the <em>Data Analysis</em> button to the right. Select <em>Regression</em> from the list of methods. In the dialog window mark the data for body mass as the range of x and the data for flipper length as the range of y. Let the output be in a new worksheet.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/315-reg1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Input to the regression function in Analysis Toolpak.</figcaption>
</figure>
</div>
<p>The most import part of the output is the bottom table. This shows the estimates for the intercept and the slope (<em>Coefficients</em>) and a p-value. The null hyptohesis of these tests is that the intercept and slope are zero. A low p-value of the slope indicates that there is a significant connection between the two variables.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Images/316-reg-output.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Output from the regression function in Analysis Toolpak.</figcaption>
</figure>
</div>
<ol start="19" type="1">
<li>Redo the regression using only the data for the Adelie penguins. Is the p-value for the slope smaller or greater than that for the full data? How does this relate to the scatterplot where the data was split by species?</li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>